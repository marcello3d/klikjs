!function(){"use strict";function t(){}function e(){e.init.call(this)}function r(t){return void 0===t._maxListeners?e.defaultMaxListeners:t._maxListeners}function n(t,e,r){if(e)t.call(r);else for(var n=t.length,o=f(t,n),i=0;i<n;++i)o[i].call(r)}function o(t,e,r,n){if(e)t.call(r,n);else for(var o=t.length,i=f(t,o),a=0;a<o;++a)i[a].call(r,n)}function i(t,e,r,n,o){if(e)t.call(r,n,o);else for(var i=t.length,a=f(t,i),s=0;s<i;++s)a[s].call(r,n,o)}function a(t,e,r,n,o,i){if(e)t.call(r,n,o,i);else for(var a=t.length,s=f(t,a),u=0;u<a;++u)s[u].call(r,n,o,i)}function s(t,e,r,n){if(e)t.apply(r,n);else for(var o=t.length,i=f(t,o),a=0;a<o;++a)i[a].apply(r,n)}function u(e,n,o,i){var a,s,u,l;if("function"!=typeof o)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",n,o.listener?o.listener:o),s=e._events),u=s[n]):(s=e._events=new t,e._eventsCount=0),u){if("function"==typeof u?u=s[n]=i?[o,u]:[u,o]:i?u.unshift(o):u.push(o),!u.warned&&(a=r(e))&&a>0&&u.length>a){u.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=n,c.count=u.length,l=c,"function"==typeof console.warn?console.warn(l):console.log(l)}}else u=s[n]=o,++e._eventsCount;return e}function l(t,e,r){var n=!1;function o(){t.removeListener(e,o),n||(n=!0,r.apply(t,arguments))}return o.listener=r,o}function c(t){var e=this._events;if(e){var r=e[t];if("function"==typeof r)return 1;if(r)return r.length}return 0}function f(t,e){for(var r=new Array(e);e--;)r[e]=t[e];return r}t.prototype=Object.create(null),e.EventEmitter=e,e.usingDomains=!1,e.prototype.domain=void 0,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.init=function(){this.domain=null,e.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new t,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},e.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},e.prototype.getMaxListeners=function(){return r(this)},e.prototype.emit=function(t){var e,r,u,l,c,f,d,_="error"===t;if(f=this._events)_=_&&null==f.error;else if(!_)return!1;if(d=this.domain,_){if(e=arguments[1],!d){if(e instanceof Error)throw e;var p=new Error('Uncaught, unspecified "error" event. ('+e+")");throw p.context=e,p}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=d,e.domainThrown=!1,d.emit("error",e),!1}if(!(r=f[t]))return!1;var h="function"==typeof r;switch(u=arguments.length){case 1:n(r,h,this);break;case 2:o(r,h,this,arguments[1]);break;case 3:i(r,h,this,arguments[1],arguments[2]);break;case 4:a(r,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(l=new Array(u-1),c=1;c<u;c++)l[c-1]=arguments[c];s(r,h,this,l)}return!0},e.prototype.addListener=function(t,e){return u(this,t,e,!1)},e.prototype.on=e.prototype.addListener,e.prototype.prependListener=function(t,e){return u(this,t,e,!0)},e.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,l(this,t,e)),this},e.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,l(this,t,e)),this},e.prototype.removeListener=function(e,r){var n,o,i,a,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(n=o[e]))return this;if(n===r||n.listener&&n.listener===r)0==--this._eventsCount?this._events=new t:(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||r));else if("function"!=typeof n){for(i=-1,a=n.length;a-- >0;)if(n[a]===r||n[a].listener&&n[a].listener===r){s=n[a].listener,i=a;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new t,this;delete o[e]}else!function(t,e){for(var r=e,n=r+1,o=t.length;n<o;r+=1,n+=1)t[r]=t[n];t.pop()}(n,i);o.removeListener&&this.emit("removeListener",e,s||r)}return this},e.prototype.removeAllListeners=function(e){var r,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new t,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new t:delete n[e]),this;if(0===arguments.length){for(var o,i=Object.keys(n),a=0;a<i.length;++a)"removeListener"!==(o=i[a])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=new t,this._eventsCount=0,this}if("function"==typeof(r=n[e]))this.removeListener(e,r);else if(r)do{this.removeListener(e,r[r.length-1])}while(r[0]);return this},e.prototype.listeners=function(t){var e,r=this._events;return r&&(e=r[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(e):[]},e.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):c.call(t,e)},e.prototype.listenerCount=c,e.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var d="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;function _(t){var e,r=void 0!==(t=t||{})?t:{},n={};for(e in r)r.hasOwnProperty(e)&&(n[e]=r[e]);var o,i="";document.currentScript&&(i=document.currentScript.src),d&&(i=d),i=0!==i.indexOf("blob:")?i.substr(0,i.lastIndexOf("/")+1):"",o=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText};var a=r.print||console.log.bind(console),s=r.printErr||console.warn.bind(console);for(e in n)n.hasOwnProperty(e)&&(r[e]=n[e]);n=null,r.arguments&&r.arguments,r.thisProgram&&r.thisProgram,r.quit&&r.quit;var u,l,c={"f64-rem":function(t,e){return t%e},debugger:function(){}};new Array(0);r.wasmBinary&&(u=r.wasmBinary),r.noExitRuntime&&r.noExitRuntime,"object"!=typeof WebAssembly&&s("no native wasm support detected");var f=!1,_="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function p(t,e,r){for(var n=e+r,o=e;t[o]&&!(o>=n);)++o;if(o-e>16&&t.subarray&&_)return _.decode(t.subarray(e,o));for(var i="";e<o;){var a=t[e++];if(128&a){var s=63&t[e++];if(192!=(224&a)){var u=63&t[e++];if((a=224==(240&a)?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&t[e++])<65536)i+=String.fromCharCode(a);else{var l=a-65536;i+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else i+=String.fromCharCode((31&a)<<6|s)}else i+=String.fromCharCode(a)}return i}function h(t,e){return t?p(y,t,e):""}function m(t,e,r,n){if(!(n>0))return 0;for(var o=r,i=r+n-1,a=0;a<t.length;++a){var s=t.charCodeAt(a);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&t.charCodeAt(++a);if(s<=127){if(r>=i)break;e[r++]=s}else if(s<=2047){if(r+1>=i)break;e[r++]=192|s>>6,e[r++]=128|63&s}else if(s<=65535){if(r+2>=i)break;e[r++]=224|s>>12,e[r++]=128|s>>6&63,e[r++]=128|63&s}else{if(r+3>=i)break;e[r++]=240|s>>18,e[r++]=128|s>>12&63,e[r++]=128|s>>6&63,e[r++]=128|63&s}}return e[r]=0,r-o}function g(t){for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&t.charCodeAt(++r)),n<=127?++e:e+=n<=2047?2:n<=65535?3:4}return e}var w,v,y,E,b;"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");function k(t,e){return t%e>0&&(t+=e-t%e),t}function D(t){w=t,r.HEAP8=v=new Int8Array(t),r.HEAP16=E=new Int16Array(t),r.HEAP32=b=new Int32Array(t),r.HEAPU8=y=new Uint8Array(t),r.HEAPU16=new Uint16Array(t),r.HEAPU32=new Uint32Array(t),r.HEAPF32=new Float32Array(t),r.HEAPF64=new Float64Array(t)}var T=r.TOTAL_MEMORY||16777216;function S(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var n=e.func;"number"==typeof n?void 0===e.arg?r.dynCall_v(n):r.dynCall_vi(n,e.arg):n(void 0===e.arg?null:e.arg)}else e()}}(l=r.wasmMemory?r.wasmMemory:new WebAssembly.Memory({initial:T/65536}))&&(w=l.buffer),T=w.byteLength,D(w),b[2712]=5253760;var P=[],F=[],A=[],x=[];var M=Math.abs,C=Math.ceil,B=Math.floor,R=Math.min,L=0,O=null;function N(t){L++,r.monitorRunDependencies&&r.monitorRunDependencies(L)}function I(t){if(L--,r.monitorRunDependencies&&r.monitorRunDependencies(L),0==L&&O){var e=O;O=null,e()}}r.preloadedImages={},r.preloadedAudios={};function z(t){return String.prototype.startsWith?t.startsWith("data:application/octet-stream;base64,"):0===t.indexOf("data:application/octet-stream;base64,")}var H,U,j,W="libtimidity.wasm";function q(){try{if(u)return new Uint8Array(u);throw"both async and sync fetching of the wasm failed"}catch(t){ut(t)}}function G(t){var e={env:t,wasi_unstable:t,global:{NaN:NaN,Infinity:1/0},"global.Math":Math,asm2wasm:c};function n(t,e){var n=t.exports;r.asm=n,I()}function o(t){n(t.instance)}function i(t){return(u||"function"!=typeof fetch?new Promise((function(t,e){t(q())})):fetch(W,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+W+"'";return t.arrayBuffer()})).catch((function(){return q()}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(t){s("failed to asynchronously prepare wasm: "+t),ut(t)}))}if(N(),r.instantiateWasm)try{return r.instantiateWasm(e,n)}catch(t){return s("Module.instantiateWasm callback failed with error: "+t),!1}return function(){if(u||"function"!=typeof WebAssembly.instantiateStreaming||z(W)||"function"!=typeof fetch)return i(o);fetch(W,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(o,(function(t){s("wasm streaming compile failed: "+t),s("falling back to ArrayBuffer instantiation"),i(o)}))}))}(),{}}function X(){var t=function(){var t=new Error;if(!t.stack){try{throw new Error(0)}catch(e){t=e}if(!t.stack)return"(no stack trace available)"}return t.stack.toString()}();return r.extraStackTrace&&(t+="\n"+r.extraStackTrace()),t.replace(/\b__Z[\w\d_]+/g,(function(t){return t==t?t:t+" ["+t+"]"}))}z(W)||(H=W,W=r.locateFile?r.locateFile(H,i):i+H),r.asm=function(t,e,r){return e.memory=l,e.table=new WebAssembly.Table({initial:26,maximum:26,element:"anyfunc"}),e.__memory_base=1024,e.__table_base=0,G(e)};var V={splitPath:function(t){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1)},normalizeArray:function(t,e){for(var r=0,n=t.length-1;n>=0;n--){var o=t[n];"."===o?t.splice(n,1):".."===o?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r;r--)t.unshift("..");return t},normalize:function(t){var e="/"===t.charAt(0),r="/"===t.substr(-1);return(t=V.normalizeArray(t.split("/").filter((function(t){return!!t})),!e).join("/"))||e||(t="."),t&&r&&(t+="/"),(e?"/":"")+t},dirname:function(t){var e=V.splitPath(t),r=e[0],n=e[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},basename:function(t){if("/"===t)return"/";var e=t.lastIndexOf("/");return-1===e?t:t.substr(e+1)},extname:function(t){return V.splitPath(t)[3]},join:function(){var t=Array.prototype.slice.call(arguments,0);return V.normalize(t.join("/"))},join2:function(t,e){return V.normalize(t+"/"+e)}};function K(t){return r.___errno_location&&(b[r.___errno_location()>>2]=t),t}var $={resolve:function(){for(var t="",e=!1,r=arguments.length-1;r>=-1&&!e;r--){var n=r>=0?arguments[r]:J.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";t=n+"/"+t,e="/"===n.charAt(0)}return(e?"/":"")+(t=V.normalizeArray(t.split("/").filter((function(t){return!!t})),!e).join("/"))||"."},relative:function(t,e){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var r=t.length-1;r>=0&&""===t[r];r--);return e>r?[]:t.slice(e,r-e+1)}t=$.resolve(t).substr(1),e=$.resolve(e).substr(1);for(var n=r(t.split("/")),o=r(e.split("/")),i=Math.min(n.length,o.length),a=i,s=0;s<i;s++)if(n[s]!==o[s]){a=s;break}var u=[];for(s=a;s<n.length;s++)u.push("..");return(u=u.concat(o.slice(a))).join("/")}},Y={ttys:[],init:function(){},shutdown:function(){},register:function(t,e){Y.ttys[t]={input:[],output:[],ops:e},J.registerDevice(t,Y.stream_ops)},stream_ops:{open:function(t){var e=Y.ttys[t.node.rdev];if(!e)throw new J.ErrnoError(19);t.tty=e,t.seekable=!1},close:function(t){t.tty.ops.flush(t.tty)},flush:function(t){t.tty.ops.flush(t.tty)},read:function(t,e,r,n,o){if(!t.tty||!t.tty.ops.get_char)throw new J.ErrnoError(6);for(var i=0,a=0;a<n;a++){var s;try{s=t.tty.ops.get_char(t.tty)}catch(t){throw new J.ErrnoError(5)}if(void 0===s&&0===i)throw new J.ErrnoError(11);if(null==s)break;i++,e[r+a]=s}return i&&(t.node.timestamp=Date.now()),i},write:function(t,e,r,n,o){if(!t.tty||!t.tty.ops.put_char)throw new J.ErrnoError(6);try{for(var i=0;i<n;i++)t.tty.ops.put_char(t.tty,e[r+i])}catch(t){throw new J.ErrnoError(5)}return n&&(t.node.timestamp=Date.now()),i}},default_tty_ops:{get_char:function(t){if(!t.input.length){var e=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(e=window.prompt("Input: "))&&(e+="\n"):"function"==typeof readline&&null!==(e=readline())&&(e+="\n"),!e)return null;t.input=rt(e,!0)}return t.input.shift()},put_char:function(t,e){null===e||10===e?(a(p(t.output,0)),t.output=[]):0!=e&&t.output.push(e)},flush:function(t){t.output&&t.output.length>0&&(a(p(t.output,0)),t.output=[])}},default_tty1_ops:{put_char:function(t,e){null===e||10===e?(s(p(t.output,0)),t.output=[]):0!=e&&t.output.push(e)},flush:function(t){t.output&&t.output.length>0&&(s(p(t.output,0)),t.output=[])}}},Z={ops_table:null,mount:function(t){return Z.createNode(null,"/",16895,0)},createNode:function(t,e,r,n){if(J.isBlkdev(r)||J.isFIFO(r))throw new J.ErrnoError(1);Z.ops_table||(Z.ops_table={dir:{node:{getattr:Z.node_ops.getattr,setattr:Z.node_ops.setattr,lookup:Z.node_ops.lookup,mknod:Z.node_ops.mknod,rename:Z.node_ops.rename,unlink:Z.node_ops.unlink,rmdir:Z.node_ops.rmdir,readdir:Z.node_ops.readdir,symlink:Z.node_ops.symlink},stream:{llseek:Z.stream_ops.llseek}},file:{node:{getattr:Z.node_ops.getattr,setattr:Z.node_ops.setattr},stream:{llseek:Z.stream_ops.llseek,read:Z.stream_ops.read,write:Z.stream_ops.write,allocate:Z.stream_ops.allocate,mmap:Z.stream_ops.mmap,msync:Z.stream_ops.msync}},link:{node:{getattr:Z.node_ops.getattr,setattr:Z.node_ops.setattr,readlink:Z.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Z.node_ops.getattr,setattr:Z.node_ops.setattr},stream:J.chrdev_stream_ops}});var o=J.createNode(t,e,r,n);return J.isDir(o.mode)?(o.node_ops=Z.ops_table.dir.node,o.stream_ops=Z.ops_table.dir.stream,o.contents={}):J.isFile(o.mode)?(o.node_ops=Z.ops_table.file.node,o.stream_ops=Z.ops_table.file.stream,o.usedBytes=0,o.contents=null):J.isLink(o.mode)?(o.node_ops=Z.ops_table.link.node,o.stream_ops=Z.ops_table.link.stream):J.isChrdev(o.mode)&&(o.node_ops=Z.ops_table.chrdev.node,o.stream_ops=Z.ops_table.chrdev.stream),o.timestamp=Date.now(),t&&(t.contents[e]=o),o},getFileDataAsRegularArray:function(t){if(t.contents&&t.contents.subarray){for(var e=[],r=0;r<t.usedBytes;++r)e.push(t.contents[r]);return e}return t.contents},getFileDataAsTypedArray:function(t){return t.contents?t.contents.subarray?t.contents.subarray(0,t.usedBytes):new Uint8Array(t.contents):new Uint8Array},expandFileStorage:function(t,e){var r=t.contents?t.contents.length:0;if(!(r>=e)){e=Math.max(e,r*(r<1048576?2:1.125)|0),0!=r&&(e=Math.max(e,256));var n=t.contents;t.contents=new Uint8Array(e),t.usedBytes>0&&t.contents.set(n.subarray(0,t.usedBytes),0)}},resizeFileStorage:function(t,e){if(t.usedBytes!=e){if(0==e)return t.contents=null,void(t.usedBytes=0);if(!t.contents||t.contents.subarray){var r=t.contents;return t.contents=new Uint8Array(new ArrayBuffer(e)),r&&t.contents.set(r.subarray(0,Math.min(e,t.usedBytes))),void(t.usedBytes=e)}if(t.contents||(t.contents=[]),t.contents.length>e)t.contents.length=e;else for(;t.contents.length<e;)t.contents.push(0);t.usedBytes=e}},node_ops:{getattr:function(t){var e={};return e.dev=J.isChrdev(t.mode)?t.id:1,e.ino=t.id,e.mode=t.mode,e.nlink=1,e.uid=0,e.gid=0,e.rdev=t.rdev,J.isDir(t.mode)?e.size=4096:J.isFile(t.mode)?e.size=t.usedBytes:J.isLink(t.mode)?e.size=t.link.length:e.size=0,e.atime=new Date(t.timestamp),e.mtime=new Date(t.timestamp),e.ctime=new Date(t.timestamp),e.blksize=4096,e.blocks=Math.ceil(e.size/e.blksize),e},setattr:function(t,e){void 0!==e.mode&&(t.mode=e.mode),void 0!==e.timestamp&&(t.timestamp=e.timestamp),void 0!==e.size&&Z.resizeFileStorage(t,e.size)},lookup:function(t,e){throw J.genericErrors[2]},mknod:function(t,e,r,n){return Z.createNode(t,e,r,n)},rename:function(t,e,r){if(J.isDir(t.mode)){var n;try{n=J.lookupNode(e,r)}catch(t){}if(n)for(var o in n.contents)throw new J.ErrnoError(39)}delete t.parent.contents[t.name],t.name=r,e.contents[r]=t,t.parent=e},unlink:function(t,e){delete t.contents[e]},rmdir:function(t,e){var r=J.lookupNode(t,e);for(var n in r.contents)throw new J.ErrnoError(39);delete t.contents[e]},readdir:function(t){var e=[".",".."];for(var r in t.contents)t.contents.hasOwnProperty(r)&&e.push(r);return e},symlink:function(t,e,r){var n=Z.createNode(t,e,41471,0);return n.link=r,n},readlink:function(t){if(!J.isLink(t.mode))throw new J.ErrnoError(22);return t.link}},stream_ops:{read:function(t,e,r,n,o){var i=t.node.contents;if(o>=t.node.usedBytes)return 0;var a=Math.min(t.node.usedBytes-o,n);if(a>8&&i.subarray)e.set(i.subarray(o,o+a),r);else for(var s=0;s<a;s++)e[r+s]=i[o+s];return a},write:function(t,e,r,n,o,i){if(!1,!n)return 0;var a=t.node;if(a.timestamp=Date.now(),e.subarray&&(!a.contents||a.contents.subarray)){if(0===a.usedBytes&&0===o)return a.contents=new Uint8Array(e.subarray(r,r+n)),a.usedBytes=n,n;if(o+n<=a.usedBytes)return a.contents.set(e.subarray(r,r+n),o),n}if(Z.expandFileStorage(a,o+n),a.contents.subarray&&e.subarray)a.contents.set(e.subarray(r,r+n),o);else for(var s=0;s<n;s++)a.contents[o+s]=e[r+s];return a.usedBytes=Math.max(a.usedBytes,o+n),n},llseek:function(t,e,r){var n=e;if(1===r?n+=t.position:2===r&&J.isFile(t.node.mode)&&(n+=t.node.usedBytes),n<0)throw new J.ErrnoError(22);return n},allocate:function(t,e,r){Z.expandFileStorage(t.node,e+r),t.node.usedBytes=Math.max(t.node.usedBytes,e+r)},mmap:function(t,e,r,n,o,i,a){if(!J.isFile(t.node.mode))throw new J.ErrnoError(19);var s,u,l=t.node.contents;if(2&a||l.buffer!==e&&l.buffer!==e.buffer){(o>0||o+n<t.node.usedBytes)&&(l=l.subarray?l.subarray(o,o+n):Array.prototype.slice.call(l,o,o+n)),u=!0;var c=e.buffer==v.buffer;if(!(s=at(n)))throw new J.ErrnoError(12);(c?v:e).set(l,s)}else u=!1,s=l.byteOffset;return{ptr:s,allocated:u}},msync:function(t,e,r,n,o){if(!J.isFile(t.node.mode))throw new J.ErrnoError(19);if(2&o)return 0;Z.stream_ops.write(t,e,0,n,r,!1);return 0}}},J={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,handleFSError:function(t){if(!(t instanceof J.ErrnoError))throw t+" : "+X();return K(t.errno)},lookupPath:function(t,e){if(e=e||{},!(t=$.resolve(J.cwd(),t)))return{path:"",node:null};var r={follow_mount:!0,recurse_count:0};for(var n in r)void 0===e[n]&&(e[n]=r[n]);if(e.recurse_count>8)throw new J.ErrnoError(40);for(var o=V.normalizeArray(t.split("/").filter((function(t){return!!t})),!1),i=J.root,a="/",s=0;s<o.length;s++){var u=s===o.length-1;if(u&&e.parent)break;if(i=J.lookupNode(i,o[s]),a=V.join2(a,o[s]),J.isMountpoint(i)&&(!u||u&&e.follow_mount)&&(i=i.mounted.root),!u||e.follow)for(var l=0;J.isLink(i.mode);){var c=J.readlink(a);if(a=$.resolve(V.dirname(a),c),i=J.lookupPath(a,{recurse_count:e.recurse_count}).node,l++>40)throw new J.ErrnoError(40)}}return{path:a,node:i}},getPath:function(t){for(var e;;){if(J.isRoot(t)){var r=t.mount.mountpoint;return e?"/"!==r[r.length-1]?r+"/"+e:r+e:r}e=e?t.name+"/"+e:t.name,t=t.parent}},hashName:function(t,e){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)|0;return(t+r>>>0)%J.nameTable.length},hashAddNode:function(t){var e=J.hashName(t.parent.id,t.name);t.name_next=J.nameTable[e],J.nameTable[e]=t},hashRemoveNode:function(t){var e=J.hashName(t.parent.id,t.name);if(J.nameTable[e]===t)J.nameTable[e]=t.name_next;else for(var r=J.nameTable[e];r;){if(r.name_next===t){r.name_next=t.name_next;break}r=r.name_next}},lookupNode:function(t,e){var r=J.mayLookup(t);if(r)throw new J.ErrnoError(r,t);for(var n=J.hashName(t.id,e),o=J.nameTable[n];o;o=o.name_next){var i=o.name;if(o.parent.id===t.id&&i===e)return o}return J.lookup(t,e)},createNode:function(t,e,r,n){if(!J.FSNode){J.FSNode=function(t,e,r,n){t||(t=this),this.parent=t,this.mount=t.mount,this.mounted=null,this.id=J.nextInode++,this.name=e,this.mode=r,this.node_ops={},this.stream_ops={},this.rdev=n},J.FSNode.prototype={};Object.defineProperties(J.FSNode.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(t){t?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(t){t?this.mode|=146:this.mode&=-147}},isFolder:{get:function(){return J.isDir(this.mode)}},isDevice:{get:function(){return J.isChrdev(this.mode)}}})}var o=new J.FSNode(t,e,r,n);return J.hashAddNode(o),o},destroyNode:function(t){J.hashRemoveNode(t)},isRoot:function(t){return t===t.parent},isMountpoint:function(t){return!!t.mounted},isFile:function(t){return 32768==(61440&t)},isDir:function(t){return 16384==(61440&t)},isLink:function(t){return 40960==(61440&t)},isChrdev:function(t){return 8192==(61440&t)},isBlkdev:function(t){return 24576==(61440&t)},isFIFO:function(t){return 4096==(61440&t)},isSocket:function(t){return 49152==(49152&t)},flagModes:{r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218},modeStringToFlags:function(t){var e=J.flagModes[t];if(void 0===e)throw new Error("Unknown file open mode: "+t);return e},flagsToPermissionString:function(t){var e=["r","w","rw"][3&t];return 512&t&&(e+="w"),e},nodePermissions:function(t,e){return J.ignorePermissions||(-1===e.indexOf("r")||292&t.mode)&&(-1===e.indexOf("w")||146&t.mode)&&(-1===e.indexOf("x")||73&t.mode)?0:13},mayLookup:function(t){var e=J.nodePermissions(t,"x");return e||(t.node_ops.lookup?0:13)},mayCreate:function(t,e){try{J.lookupNode(t,e);return 17}catch(t){}return J.nodePermissions(t,"wx")},mayDelete:function(t,e,r){var n;try{n=J.lookupNode(t,e)}catch(t){return t.errno}var o=J.nodePermissions(t,"wx");if(o)return o;if(r){if(!J.isDir(n.mode))return 20;if(J.isRoot(n)||J.getPath(n)===J.cwd())return 16}else if(J.isDir(n.mode))return 21;return 0},mayOpen:function(t,e){return t?J.isLink(t.mode)?40:J.isDir(t.mode)&&("r"!==J.flagsToPermissionString(e)||512&e)?21:J.nodePermissions(t,J.flagsToPermissionString(e)):2},MAX_OPEN_FDS:4096,nextfd:function(t,e){t=t||0,e=e||J.MAX_OPEN_FDS;for(var r=t;r<=e;r++)if(!J.streams[r])return r;throw new J.ErrnoError(24)},getStream:function(t){return J.streams[t]},createStream:function(t,e,r){J.FSStream||(J.FSStream=function(){},J.FSStream.prototype={},Object.defineProperties(J.FSStream.prototype,{object:{get:function(){return this.node},set:function(t){this.node=t}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}}));var n=new J.FSStream;for(var o in t)n[o]=t[o];t=n;var i=J.nextfd(e,r);return t.fd=i,J.streams[i]=t,t},closeStream:function(t){J.streams[t]=null},chrdev_stream_ops:{open:function(t){var e=J.getDevice(t.node.rdev);t.stream_ops=e.stream_ops,t.stream_ops.open&&t.stream_ops.open(t)},llseek:function(){throw new J.ErrnoError(29)}},major:function(t){return t>>8},minor:function(t){return 255&t},makedev:function(t,e){return t<<8|e},registerDevice:function(t,e){J.devices[t]={stream_ops:e}},getDevice:function(t){return J.devices[t]},getMounts:function(t){for(var e=[],r=[t];r.length;){var n=r.pop();e.push(n),r.push.apply(r,n.mounts)}return e},syncfs:function(t,e){"function"==typeof t&&(e=t,t=!1),J.syncFSRequests++,J.syncFSRequests>1&&console.log("warning: "+J.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var r=J.getMounts(J.root.mount),n=0;function o(t){return J.syncFSRequests--,e(t)}function i(t){if(t)return i.errored?void 0:(i.errored=!0,o(t));++n>=r.length&&o(null)}r.forEach((function(e){if(!e.type.syncfs)return i(null);e.type.syncfs(e,t,i)}))},mount:function(t,e,r){var n,o="/"===r,i=!r;if(o&&J.root)throw new J.ErrnoError(16);if(!o&&!i){var a=J.lookupPath(r,{follow_mount:!1});if(r=a.path,n=a.node,J.isMountpoint(n))throw new J.ErrnoError(16);if(!J.isDir(n.mode))throw new J.ErrnoError(20)}var s={type:t,opts:e,mountpoint:r,mounts:[]},u=t.mount(s);return u.mount=s,s.root=u,o?J.root=u:n&&(n.mounted=s,n.mount&&n.mount.mounts.push(s)),u},unmount:function(t){var e=J.lookupPath(t,{follow_mount:!1});if(!J.isMountpoint(e.node))throw new J.ErrnoError(22);var r=e.node,n=r.mounted,o=J.getMounts(n);Object.keys(J.nameTable).forEach((function(t){for(var e=J.nameTable[t];e;){var r=e.name_next;-1!==o.indexOf(e.mount)&&J.destroyNode(e),e=r}})),r.mounted=null;var i=r.mount.mounts.indexOf(n);r.mount.mounts.splice(i,1)},lookup:function(t,e){return t.node_ops.lookup(t,e)},mknod:function(t,e,r){var n=J.lookupPath(t,{parent:!0}).node,o=V.basename(t);if(!o||"."===o||".."===o)throw new J.ErrnoError(22);var i=J.mayCreate(n,o);if(i)throw new J.ErrnoError(i);if(!n.node_ops.mknod)throw new J.ErrnoError(1);return n.node_ops.mknod(n,o,e,r)},create:function(t,e){return e=void 0!==e?e:438,e&=4095,e|=32768,J.mknod(t,e,0)},mkdir:function(t,e){return e=void 0!==e?e:511,e&=1023,e|=16384,J.mknod(t,e,0)},mkdirTree:function(t,e){for(var r=t.split("/"),n="",o=0;o<r.length;++o)if(r[o]){n+="/"+r[o];try{J.mkdir(n,e)}catch(t){if(17!=t.errno)throw t}}},mkdev:function(t,e,r){return void 0===r&&(r=e,e=438),e|=8192,J.mknod(t,e,r)},symlink:function(t,e){if(!$.resolve(t))throw new J.ErrnoError(2);var r=J.lookupPath(e,{parent:!0}).node;if(!r)throw new J.ErrnoError(2);var n=V.basename(e),o=J.mayCreate(r,n);if(o)throw new J.ErrnoError(o);if(!r.node_ops.symlink)throw new J.ErrnoError(1);return r.node_ops.symlink(r,n,t)},rename:function(t,e){var r,n,o=V.dirname(t),i=V.dirname(e),a=V.basename(t),s=V.basename(e);try{r=J.lookupPath(t,{parent:!0}).node,n=J.lookupPath(e,{parent:!0}).node}catch(t){throw new J.ErrnoError(16)}if(!r||!n)throw new J.ErrnoError(2);if(r.mount!==n.mount)throw new J.ErrnoError(18);var u,l=J.lookupNode(r,a),c=$.relative(t,i);if("."!==c.charAt(0))throw new J.ErrnoError(22);if("."!==(c=$.relative(e,o)).charAt(0))throw new J.ErrnoError(39);try{u=J.lookupNode(n,s)}catch(t){}if(l!==u){var f=J.isDir(l.mode),d=J.mayDelete(r,a,f);if(d)throw new J.ErrnoError(d);if(d=u?J.mayDelete(n,s,f):J.mayCreate(n,s))throw new J.ErrnoError(d);if(!r.node_ops.rename)throw new J.ErrnoError(1);if(J.isMountpoint(l)||u&&J.isMountpoint(u))throw new J.ErrnoError(16);if(n!==r&&(d=J.nodePermissions(r,"w")))throw new J.ErrnoError(d);try{J.trackingDelegate.willMovePath&&J.trackingDelegate.willMovePath(t,e)}catch(r){console.log("FS.trackingDelegate['willMovePath']('"+t+"', '"+e+"') threw an exception: "+r.message)}J.hashRemoveNode(l);try{r.node_ops.rename(l,n,s)}catch(t){throw t}finally{J.hashAddNode(l)}try{J.trackingDelegate.onMovePath&&J.trackingDelegate.onMovePath(t,e)}catch(r){console.log("FS.trackingDelegate['onMovePath']('"+t+"', '"+e+"') threw an exception: "+r.message)}}},rmdir:function(t){var e=J.lookupPath(t,{parent:!0}).node,r=V.basename(t),n=J.lookupNode(e,r),o=J.mayDelete(e,r,!0);if(o)throw new J.ErrnoError(o);if(!e.node_ops.rmdir)throw new J.ErrnoError(1);if(J.isMountpoint(n))throw new J.ErrnoError(16);try{J.trackingDelegate.willDeletePath&&J.trackingDelegate.willDeletePath(t)}catch(e){console.log("FS.trackingDelegate['willDeletePath']('"+t+"') threw an exception: "+e.message)}e.node_ops.rmdir(e,r),J.destroyNode(n);try{J.trackingDelegate.onDeletePath&&J.trackingDelegate.onDeletePath(t)}catch(e){console.log("FS.trackingDelegate['onDeletePath']('"+t+"') threw an exception: "+e.message)}},readdir:function(t){var e=J.lookupPath(t,{follow:!0}).node;if(!e.node_ops.readdir)throw new J.ErrnoError(20);return e.node_ops.readdir(e)},unlink:function(t){var e=J.lookupPath(t,{parent:!0}).node,r=V.basename(t),n=J.lookupNode(e,r),o=J.mayDelete(e,r,!1);if(o)throw new J.ErrnoError(o);if(!e.node_ops.unlink)throw new J.ErrnoError(1);if(J.isMountpoint(n))throw new J.ErrnoError(16);try{J.trackingDelegate.willDeletePath&&J.trackingDelegate.willDeletePath(t)}catch(e){console.log("FS.trackingDelegate['willDeletePath']('"+t+"') threw an exception: "+e.message)}e.node_ops.unlink(e,r),J.destroyNode(n);try{J.trackingDelegate.onDeletePath&&J.trackingDelegate.onDeletePath(t)}catch(e){console.log("FS.trackingDelegate['onDeletePath']('"+t+"') threw an exception: "+e.message)}},readlink:function(t){var e=J.lookupPath(t).node;if(!e)throw new J.ErrnoError(2);if(!e.node_ops.readlink)throw new J.ErrnoError(22);return $.resolve(J.getPath(e.parent),e.node_ops.readlink(e))},stat:function(t,e){var r=J.lookupPath(t,{follow:!e}).node;if(!r)throw new J.ErrnoError(2);if(!r.node_ops.getattr)throw new J.ErrnoError(1);return r.node_ops.getattr(r)},lstat:function(t){return J.stat(t,!0)},chmod:function(t,e,r){var n;"string"==typeof t?n=J.lookupPath(t,{follow:!r}).node:n=t;if(!n.node_ops.setattr)throw new J.ErrnoError(1);n.node_ops.setattr(n,{mode:4095&e|-4096&n.mode,timestamp:Date.now()})},lchmod:function(t,e){J.chmod(t,e,!0)},fchmod:function(t,e){var r=J.getStream(t);if(!r)throw new J.ErrnoError(9);J.chmod(r.node,e)},chown:function(t,e,r,n){var o;"string"==typeof t?o=J.lookupPath(t,{follow:!n}).node:o=t;if(!o.node_ops.setattr)throw new J.ErrnoError(1);o.node_ops.setattr(o,{timestamp:Date.now()})},lchown:function(t,e,r){J.chown(t,e,r,!0)},fchown:function(t,e,r){var n=J.getStream(t);if(!n)throw new J.ErrnoError(9);J.chown(n.node,e,r)},truncate:function(t,e){if(e<0)throw new J.ErrnoError(22);var r;"string"==typeof t?r=J.lookupPath(t,{follow:!0}).node:r=t;if(!r.node_ops.setattr)throw new J.ErrnoError(1);if(J.isDir(r.mode))throw new J.ErrnoError(21);if(!J.isFile(r.mode))throw new J.ErrnoError(22);var n=J.nodePermissions(r,"w");if(n)throw new J.ErrnoError(n);r.node_ops.setattr(r,{size:e,timestamp:Date.now()})},ftruncate:function(t,e){var r=J.getStream(t);if(!r)throw new J.ErrnoError(9);if(0==(2097155&r.flags))throw new J.ErrnoError(22);J.truncate(r.node,e)},utime:function(t,e,r){var n=J.lookupPath(t,{follow:!0}).node;n.node_ops.setattr(n,{timestamp:Math.max(e,r)})},open:function(t,e,n,o,i){if(""===t)throw new J.ErrnoError(2);var a;if(n=void 0===n?438:n,n=64&(e="string"==typeof e?J.modeStringToFlags(e):e)?4095&n|32768:0,"object"==typeof t)a=t;else{t=V.normalize(t);try{a=J.lookupPath(t,{follow:!(131072&e)}).node}catch(t){}}var s=!1;if(64&e)if(a){if(128&e)throw new J.ErrnoError(17)}else a=J.mknod(t,n,0),s=!0;if(!a)throw new J.ErrnoError(2);if(J.isChrdev(a.mode)&&(e&=-513),65536&e&&!J.isDir(a.mode))throw new J.ErrnoError(20);if(!s){var u=J.mayOpen(a,e);if(u)throw new J.ErrnoError(u)}512&e&&J.truncate(a,0),e&=-641;var l=J.createStream({node:a,path:J.getPath(a),flags:e,seekable:!0,position:0,stream_ops:a.stream_ops,ungotten:[],error:!1},o,i);l.stream_ops.open&&l.stream_ops.open(l),!r.logReadFiles||1&e||(J.readFiles||(J.readFiles={}),t in J.readFiles||(J.readFiles[t]=1,console.log("FS.trackingDelegate error on read file: "+t)));try{if(J.trackingDelegate.onOpenFile){var c=0;1!=(2097155&e)&&(c|=J.tracking.openFlags.READ),0!=(2097155&e)&&(c|=J.tracking.openFlags.WRITE),J.trackingDelegate.onOpenFile(t,c)}}catch(e){console.log("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+e.message)}return l},close:function(t){if(J.isClosed(t))throw new J.ErrnoError(9);t.getdents&&(t.getdents=null);try{t.stream_ops.close&&t.stream_ops.close(t)}catch(t){throw t}finally{J.closeStream(t.fd)}t.fd=null},isClosed:function(t){return null===t.fd},llseek:function(t,e,r){if(J.isClosed(t))throw new J.ErrnoError(9);if(!t.seekable||!t.stream_ops.llseek)throw new J.ErrnoError(29);if(0!=r&&1!=r&&2!=r)throw new J.ErrnoError(22);return t.position=t.stream_ops.llseek(t,e,r),t.ungotten=[],t.position},read:function(t,e,r,n,o){if(n<0||o<0)throw new J.ErrnoError(22);if(J.isClosed(t))throw new J.ErrnoError(9);if(1==(2097155&t.flags))throw new J.ErrnoError(9);if(J.isDir(t.node.mode))throw new J.ErrnoError(21);if(!t.stream_ops.read)throw new J.ErrnoError(22);var i=void 0!==o;if(i){if(!t.seekable)throw new J.ErrnoError(29)}else o=t.position;var a=t.stream_ops.read(t,e,r,n,o);return i||(t.position+=a),a},write:function(t,e,r,n,o,i){if(n<0||o<0)throw new J.ErrnoError(22);if(J.isClosed(t))throw new J.ErrnoError(9);if(0==(2097155&t.flags))throw new J.ErrnoError(9);if(J.isDir(t.node.mode))throw new J.ErrnoError(21);if(!t.stream_ops.write)throw new J.ErrnoError(22);1024&t.flags&&J.llseek(t,0,2);var a=void 0!==o;if(a){if(!t.seekable)throw new J.ErrnoError(29)}else o=t.position;var s=t.stream_ops.write(t,e,r,n,o,i);a||(t.position+=s);try{t.path&&J.trackingDelegate.onWriteToFile&&J.trackingDelegate.onWriteToFile(t.path)}catch(e){console.log("FS.trackingDelegate['onWriteToFile']('"+t.path+"') threw an exception: "+e.message)}return s},allocate:function(t,e,r){if(J.isClosed(t))throw new J.ErrnoError(9);if(e<0||r<=0)throw new J.ErrnoError(22);if(0==(2097155&t.flags))throw new J.ErrnoError(9);if(!J.isFile(t.node.mode)&&!J.isDir(t.node.mode))throw new J.ErrnoError(19);if(!t.stream_ops.allocate)throw new J.ErrnoError(95);t.stream_ops.allocate(t,e,r)},mmap:function(t,e,r,n,o,i,a){if(0!=(2&i)&&0==(2&a)&&2!=(2097155&t.flags))throw new J.ErrnoError(13);if(1==(2097155&t.flags))throw new J.ErrnoError(13);if(!t.stream_ops.mmap)throw new J.ErrnoError(19);return t.stream_ops.mmap(t,e,r,n,o,i,a)},msync:function(t,e,r,n,o){return t&&t.stream_ops.msync?t.stream_ops.msync(t,e,r,n,o):0},munmap:function(t){return 0},ioctl:function(t,e,r){if(!t.stream_ops.ioctl)throw new J.ErrnoError(25);return t.stream_ops.ioctl(t,e,r)},readFile:function(t,e){if((e=e||{}).flags=e.flags||"r",e.encoding=e.encoding||"binary","utf8"!==e.encoding&&"binary"!==e.encoding)throw new Error('Invalid encoding type "'+e.encoding+'"');var r,n=J.open(t,e.flags),o=J.stat(t).size,i=new Uint8Array(o);return J.read(n,i,0,o,0),"utf8"===e.encoding?r=p(i,0):"binary"===e.encoding&&(r=i),J.close(n),r},writeFile:function(t,e,r){(r=r||{}).flags=r.flags||"w";var n=J.open(t,r.flags,r.mode);if("string"==typeof e){var o=new Uint8Array(g(e)+1),i=m(e,o,0,o.length);J.write(n,o,0,i,void 0,r.canOwn)}else{if(!ArrayBuffer.isView(e))throw new Error("Unsupported data type");J.write(n,e,0,e.byteLength,void 0,r.canOwn)}J.close(n)},cwd:function(){return J.currentPath},chdir:function(t){var e=J.lookupPath(t,{follow:!0});if(null===e.node)throw new J.ErrnoError(2);if(!J.isDir(e.node.mode))throw new J.ErrnoError(20);var r=J.nodePermissions(e.node,"x");if(r)throw new J.ErrnoError(r);J.currentPath=e.path},createDefaultDirectories:function(){J.mkdir("/tmp"),J.mkdir("/home"),J.mkdir("/home/web_user")},createDefaultDevices:function(){var t;if(J.mkdir("/dev"),J.registerDevice(J.makedev(1,3),{read:function(){return 0},write:function(t,e,r,n,o){return n}}),J.mkdev("/dev/null",J.makedev(1,3)),Y.register(J.makedev(5,0),Y.default_tty_ops),Y.register(J.makedev(6,0),Y.default_tty1_ops),J.mkdev("/dev/tty",J.makedev(5,0)),J.mkdev("/dev/tty1",J.makedev(6,0)),"object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);t=function(){return crypto.getRandomValues(e),e[0]}}t||(t=function(){ut("random_device")}),J.createDevice("/dev","random",t),J.createDevice("/dev","urandom",t),J.mkdir("/dev/shm"),J.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){J.mkdir("/proc"),J.mkdir("/proc/self"),J.mkdir("/proc/self/fd"),J.mount({mount:function(){var t=J.createNode("/proc/self","fd",16895,73);return t.node_ops={lookup:function(t,e){var r=+e,n=J.getStream(r);if(!n)throw new J.ErrnoError(9);var o={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return n.path}}};return o.parent=o,o}},t}},{},"/proc/self/fd")},createStandardStreams:function(){r.stdin?J.createDevice("/dev","stdin",r.stdin):J.symlink("/dev/tty","/dev/stdin"),r.stdout?J.createDevice("/dev","stdout",null,r.stdout):J.symlink("/dev/tty","/dev/stdout"),r.stderr?J.createDevice("/dev","stderr",null,r.stderr):J.symlink("/dev/tty1","/dev/stderr");J.open("/dev/stdin","r"),J.open("/dev/stdout","w"),J.open("/dev/stderr","w")},ensureErrnoError:function(){J.ErrnoError||(J.ErrnoError=function(t,e){this.node=e,this.setErrno=function(t){this.errno=t},this.setErrno(t),this.message="FS error"},J.ErrnoError.prototype=new Error,J.ErrnoError.prototype.constructor=J.ErrnoError,[2].forEach((function(t){J.genericErrors[t]=new J.ErrnoError(t),J.genericErrors[t].stack="<generic error, no stack>"})))},staticInit:function(){J.ensureErrnoError(),J.nameTable=new Array(4096),J.mount(Z,{},"/"),J.createDefaultDirectories(),J.createDefaultDevices(),J.createSpecialDirectories(),J.filesystems={MEMFS:Z}},init:function(t,e,n){J.init.initialized=!0,J.ensureErrnoError(),r.stdin=t||r.stdin,r.stdout=e||r.stdout,r.stderr=n||r.stderr,J.createStandardStreams()},quit:function(){J.init.initialized=!1;var t=r._fflush;t&&t(0);for(var e=0;e<J.streams.length;e++){var n=J.streams[e];n&&J.close(n)}},getMode:function(t,e){var r=0;return t&&(r|=365),e&&(r|=146),r},joinPath:function(t,e){var r=V.join.apply(null,t);return e&&"/"==r[0]&&(r=r.substr(1)),r},absolutePath:function(t,e){return $.resolve(e,t)},standardizePath:function(t){return V.normalize(t)},findObject:function(t,e){var r=J.analyzePath(t,e);return r.exists?r.object:(K(r.error),null)},analyzePath:function(t,e){try{t=(n=J.lookupPath(t,{follow:!e})).path}catch(t){}var r={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var n=J.lookupPath(t,{parent:!0});r.parentExists=!0,r.parentPath=n.path,r.parentObject=n.node,r.name=V.basename(t),n=J.lookupPath(t,{follow:!e}),r.exists=!0,r.path=n.path,r.object=n.node,r.name=n.node.name,r.isRoot="/"===n.path}catch(t){r.error=t.errno}return r},createFolder:function(t,e,r,n){var o=V.join2("string"==typeof t?t:J.getPath(t),e),i=J.getMode(r,n);return J.mkdir(o,i)},createPath:function(t,e,r,n){t="string"==typeof t?t:J.getPath(t);for(var o=e.split("/").reverse();o.length;){var i=o.pop();if(i){var a=V.join2(t,i);try{J.mkdir(a)}catch(t){}t=a}}return a},createFile:function(t,e,r,n,o){var i=V.join2("string"==typeof t?t:J.getPath(t),e),a=J.getMode(n,o);return J.create(i,a)},createDataFile:function(t,e,r,n,o,i){var a=e?V.join2("string"==typeof t?t:J.getPath(t),e):t,s=J.getMode(n,o),u=J.create(a,s);if(r){if("string"==typeof r){for(var l=new Array(r.length),c=0,f=r.length;c<f;++c)l[c]=r.charCodeAt(c);r=l}J.chmod(u,146|s);var d=J.open(u,"w");J.write(d,r,0,r.length,0,i),J.close(d),J.chmod(u,s)}return u},createDevice:function(t,e,r,n){var o=V.join2("string"==typeof t?t:J.getPath(t),e),i=J.getMode(!!r,!!n);J.createDevice.major||(J.createDevice.major=64);var a=J.makedev(J.createDevice.major++,0);return J.registerDevice(a,{open:function(t){t.seekable=!1},close:function(t){n&&n.buffer&&n.buffer.length&&n(10)},read:function(t,e,n,o,i){for(var a=0,s=0;s<o;s++){var u;try{u=r()}catch(t){throw new J.ErrnoError(5)}if(void 0===u&&0===a)throw new J.ErrnoError(11);if(null==u)break;a++,e[n+s]=u}return a&&(t.node.timestamp=Date.now()),a},write:function(t,e,r,o,i){for(var a=0;a<o;a++)try{n(e[r+a])}catch(t){throw new J.ErrnoError(5)}return o&&(t.node.timestamp=Date.now()),a}}),J.mkdev(o,i,a)},createLink:function(t,e,r,n,o){var i=V.join2("string"==typeof t?t:J.getPath(t),e);return J.symlink(r,i)},forceLoadFile:function(t){if(t.isDevice||t.isFolder||t.link||t.contents)return!0;var e=!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!o)throw new Error("Cannot load without read() or XMLHttpRequest.");try{t.contents=rt(o(t.url),!0),t.usedBytes=t.contents.length}catch(t){e=!1}return e||K(5),e},createLazyFile:function(t,e,r,n,o){function i(){this.lengthKnown=!1,this.chunks=[]}if(i.prototype.get=function(t){if(!(t>this.length-1||t<0)){var e=t%this.chunkSize,r=t/this.chunkSize|0;return this.getter(r)[e]}},i.prototype.setDataGetter=function(t){this.getter=t},i.prototype.cacheLength=function(){var t=new XMLHttpRequest;if(t.open("HEAD",r,!1),t.send(null),!(t.status>=200&&t.status<300||304===t.status))throw new Error("Couldn't load "+r+". Status: "+t.status);var e,n=Number(t.getResponseHeader("Content-length")),o=(e=t.getResponseHeader("Accept-Ranges"))&&"bytes"===e,i=(e=t.getResponseHeader("Content-Encoding"))&&"gzip"===e,a=1048576;o||(a=n);var s=this;s.setDataGetter((function(t){var e=t*a,o=(t+1)*a-1;if(o=Math.min(o,n-1),void 0===s.chunks[t]&&(s.chunks[t]=function(t,e){if(t>e)throw new Error("invalid range ("+t+", "+e+") or no bytes requested!");if(e>n-1)throw new Error("only "+n+" bytes available! programmer error!");var o=new XMLHttpRequest;if(o.open("GET",r,!1),n!==a&&o.setRequestHeader("Range","bytes="+t+"-"+e),"undefined"!=typeof Uint8Array&&(o.responseType="arraybuffer"),o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),o.send(null),!(o.status>=200&&o.status<300||304===o.status))throw new Error("Couldn't load "+r+". Status: "+o.status);return void 0!==o.response?new Uint8Array(o.response||[]):rt(o.responseText||"",!0)}(e,o)),void 0===s.chunks[t])throw new Error("doXHR failed!");return s.chunks[t]})),!i&&n||(a=n=1,n=this.getter(0).length,a=n,console.log("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=a,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var a={isDevice:!1,url:r},s=J.createFile(t,e,a,n,o);a.contents?s.contents=a.contents:a.url&&(s.contents=null,s.url=a.url),Object.defineProperties(s,{usedBytes:{get:function(){return this.contents.length}}});var u={};return Object.keys(s.stream_ops).forEach((function(t){var e=s.stream_ops[t];u[t]=function(){if(!J.forceLoadFile(s))throw new J.ErrnoError(5);return e.apply(null,arguments)}})),u.read=function(t,e,r,n,o){if(!J.forceLoadFile(s))throw new J.ErrnoError(5);var i=t.node.contents;if(o>=i.length)return 0;var a=Math.min(i.length-o,n);if(i.slice)for(var u=0;u<a;u++)e[r+u]=i[o+u];else for(u=0;u<a;u++)e[r+u]=i.get(o+u);return a},s.stream_ops=u,s},createPreloadedFile:function(t,e,n,o,i,a,s,u,l,c){Browser.init();var f=e?$.resolve(V.join2(t,e)):t;function d(n){function d(r){c&&c(),u||J.createDataFile(t,e,r,o,i,l),a&&a(),I()}var _=!1;r.preloadPlugins.forEach((function(t){_||t.canHandle(f)&&(t.handle(n,f,d,(function(){s&&s(),I()})),_=!0)})),_||d(n)}N(),"string"==typeof n?Browser.asyncLoad(n,(function(t){d(t)}),s):d(n)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(t,e,r){e=e||function(){},r=r||function(){};var n=J.indexedDB();try{var o=n.open(J.DB_NAME(),J.DB_VERSION)}catch(t){return r(t)}o.onupgradeneeded=function(){console.log("creating db"),o.result.createObjectStore(J.DB_STORE_NAME)},o.onsuccess=function(){var n=o.result.transaction([J.DB_STORE_NAME],"readwrite"),i=n.objectStore(J.DB_STORE_NAME),a=0,s=0,u=t.length;function l(){0==s?e():r()}t.forEach((function(t){var e=i.put(J.analyzePath(t).object.contents,t);e.onsuccess=function(){++a+s==u&&l()},e.onerror=function(){s++,a+s==u&&l()}})),n.onerror=r},o.onerror=r},loadFilesFromDB:function(t,e,r){e=e||function(){},r=r||function(){};var n=J.indexedDB();try{var o=n.open(J.DB_NAME(),J.DB_VERSION)}catch(t){return r(t)}o.onupgradeneeded=r,o.onsuccess=function(){var n=o.result;try{var i=n.transaction([J.DB_STORE_NAME],"readonly")}catch(t){return void r(t)}var a=i.objectStore(J.DB_STORE_NAME),s=0,u=0,l=t.length;function c(){0==u?e():r()}t.forEach((function(t){var e=a.get(t);e.onsuccess=function(){J.analyzePath(t).exists&&J.unlink(t),J.createDataFile(V.dirname(t),V.basename(t),e.result,!0,!0,!0),++s+u==l&&c()},e.onerror=function(){u++,s+u==l&&c()}})),i.onerror=r},o.onerror=r}},Q={DEFAULT_POLLMASK:5,mappings:{},umask:511,calculateAt:function(t,e){if("/"!==e[0]){var r;if(-100===t)r=J.cwd();else{var n=J.getStream(t);if(!n)throw new J.ErrnoError(9);r=n.path}e=V.join2(r,e)}return e},doStat:function(t,e,r){try{var n=t(e)}catch(t){if(t&&t.node&&V.normalize(e)!==V.normalize(J.getPath(t.node)))return-20;throw t}return b[r>>2]=n.dev,b[r+4>>2]=0,b[r+8>>2]=n.ino,b[r+12>>2]=n.mode,b[r+16>>2]=n.nlink,b[r+20>>2]=n.uid,b[r+24>>2]=n.gid,b[r+28>>2]=n.rdev,b[r+32>>2]=0,j=[n.size>>>0,(U=n.size,+M(U)>=1?U>0?(0|R(+B(U/4294967296),4294967295))>>>0:~~+C((U-+(~~U>>>0))/4294967296)>>>0:0)],b[r+40>>2]=j[0],b[r+44>>2]=j[1],b[r+48>>2]=4096,b[r+52>>2]=n.blocks,b[r+56>>2]=n.atime.getTime()/1e3|0,b[r+60>>2]=0,b[r+64>>2]=n.mtime.getTime()/1e3|0,b[r+68>>2]=0,b[r+72>>2]=n.ctime.getTime()/1e3|0,b[r+76>>2]=0,j=[n.ino>>>0,(U=n.ino,+M(U)>=1?U>0?(0|R(+B(U/4294967296),4294967295))>>>0:~~+C((U-+(~~U>>>0))/4294967296)>>>0:0)],b[r+80>>2]=j[0],b[r+84>>2]=j[1],0},doMsync:function(t,e,r,n){var o=new Uint8Array(y.subarray(t,t+r));J.msync(e,o,0,r,n)},doMkdir:function(t,e){return"/"===(t=V.normalize(t))[t.length-1]&&(t=t.substr(0,t.length-1)),J.mkdir(t,e,0),0},doMknod:function(t,e,r){switch(61440&e){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-22}return J.mknod(t,e,r),0},doReadlink:function(t,e,r){if(r<=0)return-22;var n=J.readlink(t),o=Math.min(r,g(n)),i=v[e+o];return m(n,y,e,r+1),v[e+o]=i,o},doAccess:function(t,e){if(-8&e)return-22;var r;if(!(r=J.lookupPath(t,{follow:!0}).node))return-2;var n="";return 4&e&&(n+="r"),2&e&&(n+="w"),1&e&&(n+="x"),n&&J.nodePermissions(r,n)?-13:0},doDup:function(t,e,r){var n=J.getStream(r);return n&&J.close(n),J.open(t,e,0,r,r).fd},doReadv:function(t,e,r,n){for(var o=0,i=0;i<r;i++){var a=b[e+8*i>>2],s=b[e+(8*i+4)>>2],u=J.read(t,v,a,s,n);if(u<0)return-1;if(o+=u,u<s)break}return o},doWritev:function(t,e,r,n){for(var o=0,i=0;i<r;i++){var a=b[e+8*i>>2],s=b[e+(8*i+4)>>2],u=J.write(t,v,a,s,n);if(u<0)return-1;o+=u}return o},varargs:0,get:function(t){return Q.varargs+=4,b[Q.varargs-4>>2]},getStr:function(){return h(Q.get())},getStreamFromFD:function(){var t=J.getStream(Q.get());if(!t)throw new J.ErrnoError(9);return t},get64:function(){var t=Q.get();Q.get();return t},getZero:function(){Q.get()}};function tt(t,e,r,n){try{if(!(t=J.getStream(t)))throw new J.ErrnoError(9);var o=Q.doWritev(t,e,r);return b[n>>2]=o,0}catch(t){return void 0!==J&&t instanceof J.ErrnoError||ut(t),-t.errno}}function et(){return v.length}function rt(t,e,r){var n=r>0?r:g(t)+1,o=new Array(n),i=m(t,o,0,o.length);return e&&(o.length=i),o}J.staticInit();var nt={b:ut,p:function(){},f:K,j:function(t,e){Q.varargs=e;try{var r=Q.getStreamFromFD(),n=Q.get(),o=Q.get(),i=Q.get(),a=Q.get(),s=4294967296*n+(o>>>0);return s<=-9007199254740992||s>=9007199254740992?-75:(J.llseek(r,s,a),j=[r.position>>>0,(U=r.position,+M(U)>=1?U>0?(0|R(+B(U/4294967296),4294967295))>>>0:~~+C((U-+(~~U>>>0))/4294967296)>>>0:0)],b[i>>2]=j[0],b[i+4>>2]=j[1],r.getdents&&0===s&&0===a&&(r.getdents=null),0)}catch(t){return void 0!==J&&t instanceof J.ErrnoError||ut(t),-t.errno}},i:function(t,e){Q.varargs=e;try{var r=Q.getStreamFromFD(),n=Q.get(),o=Q.get();return Q.doReadv(r,n,o)}catch(t){return void 0!==J&&t instanceof J.ErrnoError||ut(t),-t.errno}},c:function(t,e){Q.varargs=e;try{var r=Q.getStreamFromFD();switch(Q.get()){case 0:return(n=Q.get())<0?-22:J.open(r.path,r.flags,0,n).fd;case 1:case 2:return 0;case 3:return r.flags;case 4:var n=Q.get();return r.flags|=n,0;case 12:n=Q.get();return E[n+0>>1]=2,0;case 13:case 14:return 0;case 16:case 8:return-22;case 9:return K(22),-1;default:return-22}}catch(t){return void 0!==J&&t instanceof J.ErrnoError||ut(t),-t.errno}},h:function(t,e){Q.varargs=e;try{var r=Q.getStr(),n=Q.get(),o=Q.get();return J.open(r,n,o).fd}catch(t){return void 0!==J&&t instanceof J.ErrnoError||ut(t),-t.errno}},g:function(t,e){Q.varargs=e;try{var r=Q.getStreamFromFD(),n=Q.get();switch(n){case 21509:case 21505:return r.tty?0:-25;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return r.tty?0:-25;case 21519:if(!r.tty)return-25;var o=Q.get();return b[o>>2]=0,0;case 21520:return r.tty?-22:-25;case 21531:o=Q.get();return J.ioctl(r,n,o);case 21523:case 21524:return r.tty?0:-25;default:ut("bad ioctl syscall "+n)}}catch(t){return void 0!==J&&t instanceof J.ErrnoError||ut(t),-t.errno}},e:function(t,e){Q.varargs=e;try{var r=Q.getStreamFromFD();return J.close(r),0}catch(t){return void 0!==J&&t instanceof J.ErrnoError||ut(t),-t.errno}},d:function(){},o:function(){return tt.apply(null,arguments)},n:et,m:function(t,e,r){y.set(y.subarray(e,e+r),t)},l:function(t){var e=et();if(t>2147418112)return!1;for(var r=Math.max(e,16777216);r<t;)r=r<=536870912?k(2*r,65536):Math.min(k((3*r+2147483648)/4,65536),2147418112);return!!function(t){try{return l.grow(t-w.byteLength+65535>>16),D(l.buffer),1}catch(t){}}(r)},k:function(t){ut("OOM")},a:10848},ot=r.asm({},nt,w);r.asm=ot;r.___errno_location=function(){return r.asm.q.apply(null,arguments)},r._free=function(){return r.asm.r.apply(null,arguments)};var it,at=r._malloc=function(){return r.asm.s.apply(null,arguments)};r._mid_alloc_options=function(){return r.asm.t.apply(null,arguments)},r._mid_exit=function(){return r.asm.u.apply(null,arguments)},r._mid_get_load_request=function(){return r.asm.v.apply(null,arguments)},r._mid_get_load_request_count=function(){return r.asm.w.apply(null,arguments)},r._mid_init=function(){return r.asm.x.apply(null,arguments)},r._mid_istream_close=function(){return r.asm.y.apply(null,arguments)},r._mid_istream_open_mem=function(){return r.asm.z.apply(null,arguments)},r._mid_song_free=function(){return r.asm.A.apply(null,arguments)},r._mid_song_get_time=function(){return r.asm.B.apply(null,arguments)},r._mid_song_get_total_time=function(){return r.asm.C.apply(null,arguments)},r._mid_song_load=function(){return r.asm.D.apply(null,arguments)},r._mid_song_read_wave=function(){return r.asm.E.apply(null,arguments)},r._mid_song_seek=function(){return r.asm.F.apply(null,arguments)},r._mid_song_start=function(){return r.asm.G.apply(null,arguments)},r.stackAlloc=function(){return r.asm.H.apply(null,arguments)};function st(t){function e(){it||(it=!0,f||(r.noFSInit||J.init.initialized||J.init(),Y.init(),S(F),J.ignorePermissions=!1,S(A),r.onRuntimeInitialized&&r.onRuntimeInitialized(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)t=r.postRun.shift(),x.unshift(t);var t;S(x)}()))}L>0||(!function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)t=r.preRun.shift(),P.unshift(t);var t;S(P)}(),L>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),e()}),1)):e()))}function ut(t){throw r.onAbort&&r.onAbort(t),a(t+=""),s(t),f=!0,"abort("+t+"). Build with -s ASSERTIONS=1 for more info."}if(r.asm=ot,r.UTF8ToString=h,r.FS=J,r.then=function(t){if(it)t(r);else{var e=r.onRuntimeInitialized;r.onRuntimeInitialized=function(){e&&e(),t(r)}}return r},O=function t(){it||st(),it||(O=t)},r.run=st,r.abort=ut,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return!0,st(),t}const p="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);window.Timidity=class extends e{constructor(t="/midi/"){super(),this.destroyed=!1,t.endsWith("/")||(t+="/"),this._baseUrl=new URL(t,window.location.origin).href,this._ready=!1,this._playing=!1,this._pendingFetches={},this._songPtr=0,this._bufferPtr=0,this._array=new Int16Array(32768),this._currentUrlOrBuf=null,this._interval=null,this._startInterval=this._startInterval.bind(this),this._stopInterval=this._stopInterval.bind(this),this._audioContext=new p,this._node=this._audioContext.createScriptProcessor(16384,0,2),this._onAudioProcess=this._onAudioProcess.bind(this),this._node.addEventListener("audioprocess",this._onAudioProcess),this._node.connect(this._audioContext.destination),this._lib=_({locateFile:t=>new URL(t,this._baseUrl).href,onRuntimeInitialized:()=>this._onLibReady()})}_onLibReady(){if(this._lib.FS.writeFile("/timidity.cfg","\ndrumset 0\n\n 25\tDrum_000/025_Snare_Roll.pat \n 26\tDrum_000/026_Snap.pat \n 27\tDrum_000/027_High_Q.pat \n 31\tDrum_000/031_Sticks.pat \n 32\tDrum_000/032_Square_Click.pat \n 33\tDrum_000/033_Metronome_Click.pat \n 34\tDrum_000/034_Metronome_Bell.pat \n 35\tDrum_000/035_Kick_1.pat amp=100\n 36\tDrum_000/036_Kick_2.pat amp=100\n 37\tDrum_000/037_Stick_Rim.pat \n 38\tDrum_000/038_Snare_1.pat \n 39\tDrum_000/039_Clap_Hand.pat amp=100\n 40\tDrum_000/040_Snare_2.pat \n 41\tDrum_000/041_Tom_Low_2.pat amp=100\n 42\tDrum_000/042_Hi-Hat_Closed.pat \n 43\tDrum_000/043_Tom_Low_1.pat amp=100\n 44\tDrum_000/044_Hi-Hat_Pedal.pat \n 45\tDrum_000/045_Tom_Mid_2.pat amp=100\n 46\tDrum_000/046_Hi-Hat_Open.pat \n 47\tDrum_000/047_Tom_Mid_1.pat amp=100\n 48\tDrum_000/048_Tom_High_2.pat amp=100\n 49\tDrum_000/049_Cymbal_Crash_1.pat \n 50\tDrum_000/050_Tom_High_1.pat amp=100\n 51\tDrum_000/051_Cymbal_Ride_1.pat \n 52\tDrum_000/052_Cymbal_Chinese.pat \n 53\tDrum_000/053_Cymbal_Ride_Bell.pat amp=100\n 54\tDrum_000/054_Tombourine.pat \n 55\tDrum_000/055_Cymbal_Splash.pat \n 56\tDrum_000/056_Cow_Bell.pat \n 57\tDrum_000/057_Cymbal_Crash_2.pat \n 58\tDrum_000/058_Vibra-Slap.pat \n 59\tDrum_000/059_Cymbal_Ride_2.pat \n 60\tDrum_000/060_Bongo_High.pat \n 61\tDrum_000/061_Bongo_Low.pat \n 62\tDrum_000/062_Conga_High_1_Mute.pat \n 63\tDrum_000/063_Conga_High_2_Open.pat \n 64\tDrum_000/064_Conga_Low.pat \n 65\tDrum_000/065_Timbale_High.pat \n 66\tDrum_000/066_Timbale_Low.pat \n 67\tDrum_000/067_Agogo_High.pat \n 68\tDrum_000/068_Agogo_Low.pat \n 69\tDrum_000/069_Cabasa.pat amp=100\n 70\tDrum_000/070_Maracas.pat \n 71\tDrum_000/071_Whistle_1_High_Short.pat \n 72\tDrum_000/072_Whistle_2_Low_Long.pat \n 73\tDrum_000/073_Guiro_1_Short.pat \n 74\tDrum_000/074_Guiro_2_Long.pat \n 75\tDrum_000/075_Claves.pat amp=100\n 76\tDrum_000/076_Wood_Block_1_High.pat \n 77\tDrum_000/077_Wood_Block_2_Low.pat \n 78\tDrum_000/078_Cuica_1_Mute.pat amp=100\n 79\tDrum_000/079_Cuica_2_Open.pat amp=100\n 80\tDrum_000/080_Triangle_1_Mute.pat \n 81\tDrum_000/081_Triangle_2_Open.pat \n 82\tDrum_000/082_Shaker.pat \n 84\tDrum_000/084_Belltree.pat \n\nbank 0\n\n 0\tTone_000/000_Acoustic_Grand_Piano.pat amp=120 pan=center\n 1\tTone_000/001_Acoustic_Brite_Piano.pat \n 2\tTone_000/002_Electric_Grand_Piano.pat \n 4\tTone_000/004_Electric_Piano_1_Rhodes.pat \n 5\tTone_000/005_Electric_Piano_2_Chorused_Yamaha_DX.pat \n 6\tTone_000/006_Harpsichord.pat \n 7\tTone_000/007_Clavinet.pat \n 8\tTone_000/008_Celesta.pat \n 9\tTone_000/009_Glockenspiel.pat \n 13\tTone_000/013_Xylophone.pat \n 14\tTone_000/014_Tubular_Bells.pat \n 15\tTone_000/015_Dulcimer.pat \n 16\tTone_000/016_Hammond_Organ.pat \n 19\tTone_000/019_Church_Organ.pat \n 21\tTone_000/021_Accordion.pat \n 23\tTone_000/023_Tango_Accordion.pat \n 24\tTone_000/024_Nylon_Guitar.pat \n 25\tTone_000/025_Steel_Guitar.pat \n 26\tTone_000/026_Jazz_Guitar.pat \n 27\tTone_000/027_Clean_Electric_Guitar.pat \n 28\tTone_000/028_Muted_Electric_Guitar.pat \n 29\tTone_000/029_Overdriven_Guitar.pat \n 30\tTone_000/030_Distortion_Guitar.pat \n 32\tTone_000/032_Acoustic_Bass.pat \n 33\tTone_000/033_Finger_Bass.pat \n 34\tTone_000/034_Pick_Bass.pat \n 35\tTone_000/035_Fretless_Bass.pat \n 36\tTone_000/036_Slap_Bass_1.pat \n 37\tTone_000/037_Slap_Bass_2.pat \n 38\tTone_000/038_Synth_Bass_1.pat \n 40\tTone_000/040_Violin.pat \n 42\tTone_000/042_Cello.pat \n 44\tTone_000/044_Tremolo_Strings.pat \n 45\tTone_000/045_Pizzicato_Strings.pat \n 46\tTone_000/046_Harp.pat \n 47\tTone_000/047_Timpani.pat \n 48\tTone_000/048_String_Ensemble_1_Marcato.pat \n 53\tTone_000/053_Voice_Oohs.pat \n 56\tTone_000/056_Trumpet.pat \n 57\tTone_000/057_Trombone.pat \n 58\tTone_000/058_Tuba.pat \n 59\tTone_000/059_Muted_Trumpet.pat \n 60\tTone_000/060_French_Horn.pat \n 61\tTone_000/061_Brass_Section.pat \n 64\tTone_000/064_Soprano_Sax.pat \n 65\tTone_000/065_Alto_Sax.pat \n 66\tTone_000/066_Tenor_Sax.pat \n 67\tTone_000/067_Baritone_Sax.pat \n 68\tTone_000/068_Oboe.pat \n 69\tTone_000/069_English_Horn.pat \n 70\tTone_000/070_Bassoon.pat \n 71\tTone_000/071_Clarinet.pat \n 72\tTone_000/072_Piccolo.pat \n 73\tTone_000/073_Flute.pat \n 74\tTone_000/074_Recorder.pat \n 75\tTone_000/075_Pan_Flute.pat \n 76\tTone_000/076_Bottle_Blow.pat \n 79\tTone_000/079_Ocarina.pat \n 80\tTone_000/080_Square_Wave.pat \n 84\tTone_000/084_Charang.pat \n 88\tTone_000/088_New_Age.pat \n 94\tTone_000/094_Halo_Pad.pat \n 95\tTone_000/095_Sweep_Pad.pat \n 98\tTone_000/098_Crystal.pat \n 101\tTone_000/101_Goblins--Unicorn.pat \n 102\tTone_000/102_Echo_Voice.pat \n 104\tTone_000/104_Sitar.pat \n 114\tTone_000/114_Steel_Drums.pat \n 115\tTone_000/115_Wood_Block.pat \n 120\tTone_000/120_Guitar_Fret_Noise.pat \n 122\tTone_000/122_Seashore.pat \n 125\tTone_000/125_Helicopter.pat \n\n"),0!==this._lib._mid_init("/timidity.cfg"))return this._destroy(new Error("Failed to initialize libtimidity"));this._bufferPtr=this._lib._malloc(65536),this._ready=!0,this.emit("_ready")}async load(t){if(this.destroyed)throw new Error("load() called after destroy()");if(this._audioContext.resume(),this._songPtr&&this._destroySong(),this.emit("unstarted"),this._stopInterval(),!this._ready)return this.once("_ready",()=>this.load(t));let e;if(this.emit("buffering"),this._currentUrlOrBuf=t,"string"==typeof t){if(e=await this._fetch(new URL(t,this._baseUrl)),this._currentUrlOrBuf!==t)return}else{if(!(t instanceof Uint8Array))throw new Error("load() expects a `string` or `Uint8Array` argument");e=t}let r=this._loadSong(e),n=this._lib._mid_get_load_request_count(r);if(n>0){let o=this._getMissingInstruments(r,n);if(await Promise.all(o.map(t=>this._fetchInstrument(t))),this._currentUrlOrBuf!==t)return;this._lib._mid_song_free(r),r=this._loadSong(e),n=this._lib._mid_get_load_request_count(r),n>0&&(o=this._getMissingInstruments(r,n))}this._songPtr=r,this._lib._mid_song_start(this._songPtr)}_getMissingInstruments(t,e){const r=[];for(let n=0;n<e;n++){const e=this._lib._mid_get_load_request(t,n),o=this._lib.UTF8ToString(e);r.push(o)}return r}_loadSong(t){const e=this._lib._mid_alloc_options(44100,32784,2,16384),r=this._lib._malloc(t.byteLength);this._lib.HEAPU8.set(t,r);const n=this._lib._mid_istream_open_mem(r,t.byteLength),o=this._lib._mid_song_load(n,e);return this._lib._mid_istream_close(n),this._lib._free(e),this._lib._free(r),0===o?this._destroy(new Error("Failed to load MIDI file")):o}async _fetchInstrument(t){if(this._pendingFetches[t])return this._pendingFetches[t];const e=new URL(t,this._baseUrl),r=this._fetch(e);this._pendingFetches[t]=r;const n=await r;return this._writeInstrumentFile(t,n),delete this._pendingFetches[t],n}_writeInstrumentFile(t,e){const r=t.split("/").slice(0,-1).join("/");this._mkdirp(r),this._lib.FS.writeFile(t,e,{encoding:"binary"})}_mkdirp(t){const e=t.split("/");let r="/";for(let t=0;t<e.length;t++){const n=e[t];try{this._lib.FS.mkdir(`${r}${n}`)}catch(t){}r+=n+"/"}}async _fetch(t){const e=await window.fetch(t,{mode:"cors",credentials:"same-origin"});if(200!==e.status)throw new Error("Could not load "+t);const r=await e.arrayBuffer();return new Uint8Array(r)}play(){if(this.destroyed)throw new Error("play() called after destroy()");this._audioContext.resume(),this._playing=!0,this._ready&&!this._currentUrlOrBuf&&(this.emit("playing"),this._startInterval())}_onAudioProcess(t){const e=this._songPtr&&this._playing?this._readMidiData():0;e>0&&this._currentUrlOrBuf&&(this._currentUrlOrBuf=null,this.emit("playing"),this._startInterval());const r=t.outputBuffer.getChannelData(0),n=t.outputBuffer.getChannelData(1);for(let t=0;t<e;t++)r[t]=this._array[2*t]/32767,n[t]=this._array[2*t+1]/32767;for(let t=e;t<16384;t++)r[t]=0,n[t]=0;this._songPtr&&this._playing&&0===e&&(this.seek(0),this.pause(),this._lib._mid_song_start(this._songPtr),this.emit("ended"))}_readMidiData(){const t=this._lib._mid_song_read_wave(this._songPtr,this._bufferPtr,65536),e=t/4;return 0===e?0:(this._array.set(this._lib.HEAP16.subarray(this._bufferPtr/2,(this._bufferPtr+t)/2)),e)}pause(){if(this.destroyed)throw new Error("pause() called after destroy()");this._playing=!1,this._stopInterval(),this.emit("paused")}seek(t){if(this.destroyed)throw new Error("seek() called after destroy()");if(!this._songPtr)return;const e=Math.floor(1e3*t);this._lib._mid_song_seek(this._songPtr,e),this._onTimeupdate()}get currentTime(){return this.destroyed||!this._songPtr?0:this._lib._mid_song_get_time(this._songPtr)/1e3}get duration(){return this.destroyed||!this._songPtr?1:this._lib._mid_song_get_total_time(this._songPtr)/1e3}_onTimeupdate(){this.emit("timeupdate",this.currentTime)}_startInterval(){this._onTimeupdate(),this._interval=setInterval(()=>this._onTimeupdate(),1e3)}_stopInterval(){this._onTimeupdate(),clearInterval(this._interval),this._interval=null}destroy(){if(this.destroyed)throw new Error("destroy() called after destroy()");this._destroy()}_destroy(t){this.destroyed||(this.destroyed=!0,this._stopInterval(),this._array=null,this._songPtr&&this._destroySong(),this._bufferPtr&&(this._lib._free(this._bufferPtr),this._bufferPtr=0),this._node&&(this._node.disconnect(),this._node.removeEventListener("audioprocess",this._onAudioProcess)),this._audioContext&&this._audioContext.close(),t&&this.emit("error",t))}_destroySong(){this._lib._mid_song_free(this._songPtr),this._songPtr=0}}}();
